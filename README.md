PHP7 Mapnik
===========

<img src="header_graphic.png?raw=true" alt="PHP7 Mapnik" title="Generated by PHP7 Mapnik" width="640" height="160">

Introduction
------------

PHP7 Mapnik brings geospatial rendering to PHP via the powerful [Mapnik](http://mapnik.org/) XML API.
It is ideal for building dynamic tile servers or livening up websites with custom static maps.

[![Build Status](https://travis-ci.org/garrettrayj/php7-mapnik.svg?branch=master)](https://travis-ci.org/garrettrayj/php7-mapnik)

Requirements
------------

* PHP 7.0.x
   * php7.0-gd 
   * php7.0-dev
   * Available through `sudo apt-get install php-dev php-gd` on Ubuntu 16.04 Xenial
* Mapnik 3.0.x
* mapnik-config
    * Available through `sudo apt-get install libmapnik-dev` on Ubuntu 16.04 Xenial

Installation
------------

    # git clone ... && cd php7-mapnik
    phpize
    ./configure --with-mapnik
    make test
    make install
    echo "extension=mapnik.so" > /etc/php.d/mapnik.ini

Note: Your PHP configuration directory may be different depending on OS and PHP settings.

Tile Server Example
-------------------

    ./example/run.sh

Point your web browser to [http://localhost:8000/](http://localhost:8000/)

Usage
-----

    <?php

    // Register datasource plugins
    $pluginConfigOutput = [];
    exec('mapnik-config --input-plugins', $pluginConfigOutput);
    \Mapnik\DatasourceCache::registerDatasources($pluginConfigOutput[0]);

    // Create map
    $map = new \Mapnik\Map(640, 480);

    // Register fonts
    $fontConfigOutput = [];
    exec('mapnik-config --fonts', $fontConfigOutput);
    $map->registerFonts($fontConfigOutput[0]);

    // Load Mapnik XML
    $map->loadXmlFile('my_awesome_map.xml', false, $basePath);

    // Situate the map within the viewport
    $map->zoomAll();

    // Create image
    $image = new \Mapnik\Image(640, 480);

    // Render
    $renderer = new \Mapnik\AggRenderer($map, $image);
    $renderer->apply();

    // Save PNG image
    $image->saveToFile('my_awesome_map.png');